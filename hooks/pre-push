#!/usr/bin/env bash

# Pre-push hook f√ºr Dev-CLI-Tools
# F√ºhrt umfassendere Tests durch, bevor Code gepusht wird

set -e

echo "üöÄ F√ºhre Pre-push Pr√ºfungen durch..."

# F√ºhre shellcheck aus (wenn installiert)
if command -v shellcheck &>/dev/null; then
  echo "‚úì F√ºhre ShellCheck aus..."
  shellcheck -S warning src/dev || {
    echo "‚ùå ShellCheck hat Probleme gefunden!"
    exit 1
  }
else
  echo "‚ö†Ô∏è ShellCheck ist nicht installiert - √ºberspringe Pr√ºfung"
  echo "   Installiere es mit 'brew install shellcheck' oder 'apt-get install shellcheck'"
fi

# F√ºhre BATS-Tests aus (wenn vorhanden)
if [ -d "tests" ] && [ -f "tests/test_dev.bats" ]; then
  if command -v bats &>/dev/null; then
    echo "‚úì F√ºhre BATS-Tests aus..."
    
    # Setze Testmodus, um Docker-Pr√ºfungen zu √ºberspringen
    export DEV_TEST_MODE=true
    
    bats tests/test_dev.bats || {
      echo "‚ùå BATS-Tests fehlgeschlagen!"
      unset DEV_TEST_MODE
      exit 1
    }
    
    unset DEV_TEST_MODE
  else
    echo "‚ö†Ô∏è BATS ist nicht installiert - √ºberspringe Tests"
    echo "   Installiere es mit 'brew install bats-core' oder 'npm install -g bats'"
  fi
else
  echo "‚ö†Ô∏è Keine BATS-Tests gefunden - √ºberspringe Tests"
fi

echo "‚úÖ Alle Pre-push Pr√ºfungen bestanden!"
exit 0 