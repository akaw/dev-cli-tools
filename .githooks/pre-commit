#!/usr/bin/env bash

# Colors for output
RED='\033[0;31m'
GREEN='\033[0;32m'
YELLOW='\033[0;33m'
NC='\033[0m' # No Color

echo -e "${YELLOW}Running pre-commit hook...${NC}"

# Check version consistency
echo -e "${YELLOW}Checking version consistency...${NC}"
README_VERSION=$(grep -o "version-[0-9.]*" README.md | head -1 | cut -d'-' -f2)
SCRIPT_VERSION=$(grep "^VERSION=" src/dev | cut -d'"' -f2)

if [ "$README_VERSION" != "$SCRIPT_VERSION" ]; then
    echo -e "${RED}Version mismatch! README: $README_VERSION, Script: $SCRIPT_VERSION${NC}"
    echo -e "${RED}Please update the versions to match before committing.${NC}"
    exit 1
else
    echo -e "${GREEN}Version consistency check passed${NC}"
fi

# Check basic syntax
if [ -f src/dev ]; then
    if ! bash -n src/dev; then
        echo -e "${RED}Bash syntax check failed. Please fix the errors before committing.${NC}"
        exit 1
    fi
fi

# Check for executable permissions
if [ -f src/dev ] && [ ! -x src/dev ]; then
    echo -e "${RED}The script src/dev is not executable. Please run 'chmod +x src/dev'.${NC}"
    exit 1
fi

echo -e "${GREEN}Pre-commit checks passed${NC}"
exit 0
